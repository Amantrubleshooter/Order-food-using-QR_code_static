{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Select Items - Admin Order</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .item-card { cursor: pointer; transition: all 0.3s; }
        .item-card:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .cart-fixed { position: sticky; top: 20px; }
    </style>
</head>
<body>
    <div class="container-fluid my-4">
        <div class="row">
            <div class="col-md-8">
                <h3>Select Items for Order</h3>
                
                <div class="btn-group mb-3" role="group">
                    <button class="btn btn-outline-primary active" onclick="filterCategory('all')">All</button>
                    {% for cat in categories %}
                    <button class="btn btn-outline-primary" onclick="filterCategory('{{ cat }}')">{{ cat|title }}</button>
                    {% endfor %}
                </div>
                
                <div class="row g-3" id="itemsGrid">
                    {% for item in menu_items %}
                    <div class="col-md-3 item-box" data-category="{{ item.category }}">
                        <div class="card item-card" onclick="addToCart({{ item.id }}, '{{ item.name }}', {{ item.price }})">
                            <img src="{% static item.pic %}" class="card-img-top" style="height: 150px; object-fit: cover;">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title mb-1">{{ item.name }}</h6>
                                <p class="text-success fw-bold mb-0">₹{{ item.price }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card cart-fixed">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Order Cart</h5>
                    </div>
                    <div class="card-body">
                        <div id="cartItems" style="max-height: 400px; overflow-y: auto;">
                            <p class="text-muted">No items added yet</p>
                        </div>
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Total:</strong>
                            <strong id="cartTotal">₹0</strong>
                        </div>
                        
                        <form method="POST" id="orderForm">
                            {% csrf_token %}
                            <input type="hidden" name="cart_data" id="cartData">
                            <button type="submit" class="btn btn-success w-100 mb-2" id="placeOrderBtn" disabled>
                                Place Order
                            </button>
                            <a href="{% url 'admin_place_order' %}" class="btn btn-secondary w-100">Back</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let cart = [];
        
        function filterCategory(cat) {
            const items = document.querySelectorAll('.item-box');
            items.forEach(item => {
                if (cat === 'all' || item.dataset.category === cat) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            document.querySelectorAll('.btn-group button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function addToCart(id, name, price) {
            const existing = cart.find(item => item.id === id);
            
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ id, name, price: parseInt(price), quantity: 1 });
            }
            
            updateCart();
        }
        
        function updateQuantity(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
            }
            updateCart();
        }
        
        function removeItem(id) {
            cart = cart.filter(i => i.id !== id);
            updateCart();
        }
        
        function updateCart() {
            const cartDiv = document.getElementById('cartItems');
            const totalDiv = document.getElementById('cartTotal');
            const placeBtn = document.getElementById('placeOrderBtn');
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p class="text-muted">No items added yet</p>';
                totalDiv.textContent = '₹0';
                placeBtn.disabled = true;
                return;
            }
            
            let html = '';
            let total = 0;
            
            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;
                
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                        <div class="flex-grow-1">
                            <strong>${item.name}</strong><br>
                            <small class="text-muted">₹${item.price} each</small>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <button type="button" class="btn btn-outline-secondary disabled">${item.quantity}</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger ms-2" onclick="removeItem(${item.id})">×</button>
                    </div>
                `;
            });
            
            cartDiv.innerHTML = html;
            totalDiv.textContent = '₹' + total;
            placeBtn.disabled = false;
            
            document.getElementById('cartData').value = JSON.stringify(cart);
        }
    </script>
</body>
</html>